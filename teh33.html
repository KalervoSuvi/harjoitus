<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funktiolaskin</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Funktiolaskin</h1>
    <form id="function-form">
        <table>
            <tr>
                <td><label for="function">Funktio:</label></td>
                <td><input type="text" id="function" name="function" required></td>
            </tr>
            <tr>
                <td><label for="x-start">x-alueen alku:</label></td>
                <td><input type="number" id="x-start" name="x-start" value="0" required></td>
            </tr>
            <tr>
                <td><label for="x-end">x-alueen loppu:</label></td>
                <td><input type="number" id="x-end" name="x-end" value="100" required></td>
            </tr>
            <tr>
                <td><label for="x-step">x askel:</label></td>
                <td><input type="number" id="x-step" name="x-step" value="0.5" step="0.1" required></td>
            </tr>
            <tr>
                <td colspan="2" style="text-align: center;">
                    <button type="button" onclick="calculateAndDraw()">Laske</button>
                </td>
            </tr>
        </table>
    </form>
    
    <canvas id="chart" width="400" height="200"></canvas>
    
    <h2>Tulokset</h2>
    <pre id="results"></pre>
    
    <script>
        let chart;

        function calculateAndDraw() {
            // Hakee syötteet
            const func = document.getElementById('function').value;
            const xStart = parseFloat(document.getElementById('x-start').value);
            const xEnd = parseFloat(document.getElementById('x-end').value);
            const xStep = parseFloat(document.getElementById('x-step').value);

            // Tarkistaa, että x-alueen loppuarvo on suurempi kuin alkuarvo
            if (xEnd <= xStart) {
                alert('x-alueen loppuarvon on oltava suurempi kuin alkuarvon!');
                return;
            }

            let results = [];
            let xValues = [];
            let yValues = [];

            // Luo funktion käyttäjän syötteestä
            const safeFunc = new Function('x', `with (Math) { return ${func}; }`);

            // Laskee funktion arvot
            for (let x = xStart; x <= xEnd; x += xStep) {
                let y;
                try {
                    y = safeFunc(x);
                } catch (e) {
                    alert('Virheellinen funktio!');
                    return;
                }
                results.push(`f(${x}) = ${y}`);
                xValues.push(x);
                yValues.push(y);
            }

            // Näyttää tulokset
            document.getElementById('results').textContent = results.join('\n');
            // Piirtää kaavion
            drawChart(xValues, yValues);
        }

        function drawChart(xValues, yValues) {
            const ctx = document.getElementById('chart').getContext('2d'); //canvas
            

            //tarkistaa onko kaaviota piirretty, tekee uuden
            if (chart) {
                chart.data.labels = xValues;
                chart.data.datasets[0].data = yValues;
                chart.update();
            } else {
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: xValues,
                        datasets: [{
                            label: 'Funktio',
                            data: yValues,
                           borderWidth: 1,
                            pointRadius: 0 // Ei näytetä pisteitä
                        }]
                    },
                    options: {
                        scales: {
                            x: {
                                beginAtZero: true
                            },
                            y: {
                                beginAtZero: true
                            }
                        },
                        elements: {
                            line: {
                                tension: 0.4 // Pehmeämmät käyrät
                            }
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>